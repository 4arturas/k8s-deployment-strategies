

```sh
docker run -d --name prometheus \
    -p 9999:9090 \
    -v "./k6/prometheus.yml:/prometheus/prometheus.yml" \
    prom/prometheus \
    --web.enable-remote-write-receiver
````

Check if Prometheus is running and ready.

```sh
docker ps
````

```sh
curl http://localhost:9999/-/ready
````

### 3. Grafana Setup

Run the Grafana container, exposing port `3000` and mounting the directories containing your dashboard and datasource provisioning files. Grafana will automatically pick up the Prometheus datasource and the sample dashboard.

```sh
docker run -d -p 3000:3000 --name grafana \
  -v "C:/Users/4artu/IdeaProjects/k8s-deployment-strategies/k6/provisioning:/etc/grafana/provisioning:ro" \
  -v "C:/Users/4artu/IdeaProjects/k8s-deployment-strategies/k6/dashboards:/var/lib/grafana/dashboards:ro" \
  grafana/grafana-oss
````

Check the logs to ensure Grafana started correctly (look for the admin password if you need it, though defaults are usually `admin`/`admin`).

```sh
docker logs grafana
````

### 4. k6 Test Execution

Execute the k6 test script. The `-o experimental-prometheus-rw` output sends metrics directly to the Prometheus container using the environment variable `K6_PROMETHEUS_RW_SERVER_URL` (which uses the container name `http://prometheus:9090`).

```sh
docker run --rm --name k6 \
      -v "C:/Users/4artu/IdeaProjects/k8s-deployment-strategies/k6/tests:/tests:ro" \
      -w //tests -e K6_PROMETHEUS_RW_SERVER_URL=http://host.docker.internal:9999/api/v1/write \
      grafana/k6 \
      run -o experimental-prometheus-rw script.js
````

### 5. Cleanup (Teardown)

Once you are finished, use these commands to stop and remove the containers.

```sh
docker stop prometheus && docker rm prometheus
````

```sh
docker stop grafana && docker rm grafana
````
